(function(a) {
    a.fn.downCount = function(e, h) {
        var g = a.extend({
            date: null,
            offset: null
        }, e);
        if (!g.date) {
            a.error("Date is not defined.")
        }
        if (!Date.parse(g.date)) {
            a.error("Incorrect date format, it should look like this, 12/24/2012 12:00:00.")
        }
        var c = this;
        var b = function() {
            var i = new Date();
            return i
        };
        function f(m) {
            var temp_date;
            temp_date = g.date + ' GMT+0800'
            var r = new Date(temp_date)
              , k = b();
            var j = r - k;
            if (j < 0) {
                clearInterval(d);
                if (h && typeof h === "function") {
                    h()
                }
                return
            }
            var n = 1000
              , p = n * 60
              , i = p * 60
              , t = i * 24;
            var s = Math.floor(j / t)
              , o = Math.floor((j % t) / i)
              , l = Math.floor((j % i) / p)
              , q = Math.floor((j % p) / n);
            s = (String(s).length >= 2) ? s : "0" + s;
            o = (String(o).length >= 2) ? o : "0" + o;
            l = (String(l).length >= 2) ? l : "0" + l;
            q = (String(q).length >= 2) ? q : "0" + q;
            c.find(".days").text(s);
            c.find(".hours").text(o);
            c.find(".minutes").text(l);
            c.find(".seconds").text(q)
        }
        var d = setInterval(f, 1000);
        this.reset = function() {
            clearInterval(d);
            c.find(".days").text("00");
            c.find(".hours").text("00");
            c.find(".minutes").text("00");
            c.find(".seconds").text("00")
        }
        ;
        return this
    }
}
)(jQuery);
(function() {
    var a = (function() {
        var f = window.location.origin;
        var h = 6000;
        var g = {
            transactionQuery: f + "/merchant/recharge.recharge/payresult"
        };
        var d = null;
        var c = null;
        var e = ["NORMAL_DONE", "MANUAL_DONE", "PARTIAL_DONE", "OVER_DONE", "PARTIAL_OVER_DONE", "1"];
        return {
            api: g,
            transactionQueryInterval: h,
            transactionQuery: d,
            downCounter: c,
            resolvedStatus: e
        }
    }
    )();
    var b = (function() {
        var c = function() {
            window.onload = function() {
                var g = 0;
                document.addEventListener("touchstart", function(h) {
                    if (h.touches.length > 1) {
                        h.preventDefault()
                    }
                });
                document.addEventListener("touchend", function(i) {
                    var h = (new Date()).getTime();
                    if (h - g <= 300) {
                        i.preventDefault()
                    }
                    g = h
                }, false);
                document.addEventListener("gesturestart", function(h) {
                    h.preventDefault()
                })
            }
        };
        var f = function() {
            if (token && timeout) {
                var g = function() {
                    if (timeout) {
                        $.ajax({
                            type: "get",
                            url: a.api.transactionQuery,
                            data: {
                                token: token
                            },
                            success: function(h) {
                                if (h.code == 1) {
                                    if (a.resolvedStatus.includes(h.data.status)) {
                                        clearInterval(a.transactionQuery);
                                        a.downCounter && a.downCounter.reset();
                                        window.location.href = redirectUrl;
                                        return;
                                        if (redirectUrl) {
                                            setTimeout(function() {
                                                window.location.replace(redirectUrl)
                                            }, 6000)
                                        } else {
                                            i = 60000000;
							                var h = document.createElement("div");
							                h.innerHTML = "充值订单支付成功,跳转中...";
							                h.style.cssText = "font-size: 16px; width:190px; max-width: 190px; background:#DC143C; opacity:0.9; height:40px; color:#fff; line-height:40px; text-align:center; btransaction-radius:8px; position:fixed; bottom:50px; left:50%; margin-left: -80px; z-index:9; font-weight:bold;";
							                document.body.appendChild(h);
							                setTimeout(function() {
                                                window.location.href = redirectUrl;
                                            }, 3000)
                                        }
                                    }
                                }
                            }
                        })
                    } else {
                        clearInterval(a.transactionQuery)
                    }
                };
                a.transactionQuery = setInterval(function() {
                    g()
                }, a.transactionQueryInterval)
            }
        };
        var d = function() {
            if (timeout) {
                try {
                    a.downCounter = $(".downcount").downCount({
                        date: timeout,
                        offset: +10
                    }, function() {
                        window.location.href = redirectUrl;
                    })
                } catch (g) {}
            }
        };
        var e = function() {
            var g = function(j, i) {
                i = isNaN(i) ? 3000 : i;
                var h = document.createElement("div");
                h.innerHTML = j;
                h.style.cssText = "font-size: 16px; width:160px; max-width: 160px; background:#000; opacity:0.9; height:40px; color:#fff; line-height:40px; text-align:center; btransaction-radius:8px; position:fixed; bottom:50px; left:50%; margin-left: -80px; z-index:9; font-weight:bold;";
                document.body.appendChild(h);
                setTimeout(function() {
                    var k = 0.5;
                    h.style.webkitTransition = "-webkit-transform " + k + "s ease-in, opacity " + k + "s ease-in";
                    h.style.opacity = "0";
                    setTimeout(function() {
                        document.body.removeChild(h)
                    }, k * 500)
                }, i)
            };
            $(".parse-action").on("click", function() {
                var i = $(this).attr("data-ref");
                var h = $(this).attr("data-msg");
                if (i) {
                    const range = document.createRange();
                    range.selectNode(document.getElementById(i.slice(1)));
                    const selection = window.getSelection();
                    //移除之前选中内容
                    if (selection.rangeCount>0) selection.removeAllRanges();
                    selection.addRange(range);
                    document.execCommand('copy');
                    selection.removeAllRanges()
                    g(h, 2000)
                }
            })
        };
        return {
            init: function() {
                c();
                d();
                f();
                e()
            }
        }
    }
    )();
    b.init()
}());
